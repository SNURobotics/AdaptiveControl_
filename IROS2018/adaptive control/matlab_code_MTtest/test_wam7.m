
G = zeros(6,6,7);
Tsb = zeros(4,4,7);
Tsb(:,:,1) = eye(4,4);
% for i =1 : 6
%     G(:,:,i) = robot.link(i).J;
%     if i == 1 
%         Tsb(:,:,i) = robot.link(i).M;
%     else
%         Tsb(:,:,i) = Tsb(:,:,i-1)*robot.link(i).M;
%     end
% end
% plot_inertiatensor(Tsb(:,:,4), G(:,:,4), 0.5, rand(1,3));


% I = [0.2948635027286643, 0.007950224642941463,  9.310396523921739e-05;0.007950224642941463,0.11350016774623556, 0.00018710326437239235; 9.310396523921739e-05, 0.00018710326437239235, 0.25065343014390495 ];
% m = 10.76768767;
% h = [-0.04774629602006741 ; 1.3124776494944914 ;-0.0071593278549063 ];
% 
% p = [-0.00443422; 0.12189039; -0.00066489];
% Ic = [0.13488033, -0.00213041, -0.00012485; -0.00213041, 0.11328369,0.00068555;-0.00012485,0.00068555, 0.09046330 ];

dh_par = [-pi/2, 0, 0, 0;
    pi/2, 0, 0, 0;
    -pi/2, 0.045, 0.55,0;
    pi/2, -0.045, 0, 0;
    -pi/2, 0, 0.3, 0;
    pi/2, 0, 0, 0;
    0, 0, 0.06, 0];
dh_par(:,4) = pi*rand(7,1)-pi/2;
for i = 1 : 7
    T_relative = [RotZ(dh_par(i,4)),[0;0;dh_par(i,3)];0,0,0,1]*[RotX(dh_par(i,1)),[dh_par(i,2);0;0];0,0,0,1];
        alpha = dh_par(i,1); a = dh_par(i,2); d = dh_par(i,3); theta = dh_par(i,4);
    if i == 1 
        Tsb(:,:,i) = T_relative;
    else
        Tsb(:,:,i) = Tsb(:,:,i-1)*T_relative;
    end
end
Inertia_par = [0.294863503
0.007950225
9.31E-05
0.113500168
0.000187103
0.25065343
-0.047746296
1.312477649
-0.007159328
10.76768767
0.0260684
1.35E-05
0.000117001
0.014722017
-3.66E-05
0.019348137
-0.009182943
0.120340603
0.059755955
3.87493756
0.13671601
0.016804342
-5.10E-06
0.005883535
5.29E-06
0.139513702
-0.068952728
0.37398727
5.96E-05
1.80228141
0.057192689
-1.47E-05
-8.19E-05
0.05716471
9.42E-05
0.003004404
0.011965126
-0.000550647
0.31854219
2.40016804
5.59E-05
-2.56E-07
1.88E-09
7.82E-05
8.33E-07
6.59E-05
1.10E-05
0.000632683
0.000539377
0.12376019
0.000931067
-1.48E-06
2.01E-06
0.000498334
0.000221618
0.000574835
-5.13E-05
-0.007118902
0.010316994
0.41797364
3.85E-05
1.91E-07
-1.77E-08
3.88E-05
3.62E-08
7.41E-05
-5.47E-06
1.12E-05
-0.00022211
0.06864753];
for i =1 : 7
    inertia_cur =Inertia_par(10*(i-1)+1:10*i);
    I = [inertia_cur(1), inertia_cur(2), inertia_cur(3);inertia_cur(2), inertia_cur(4), inertia_cur(5);inertia_cur(3), inertia_cur(5), inertia_cur(6)];
    m = inertia_cur(10);
    h = [inertia_cur(7);inertia_cur(8);inertia_cur(9)];
    G(:,:,i) = [I, skew(h);-skew(h),m*eye(3,3)];
end

for i =1 : 7
plot_inertiatensor(Tsb(:,:,i), G(:,:,i), 0.5, rand(7,3)); hold on;
draw_SE3(Tsb(:,:,i));
end


